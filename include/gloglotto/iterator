/** Copyleft (É”) meh. - http://meh.schizofreni.co
 *
 * This file is part of gloglotto - https://github.com/meh/gloglotto
 *
 * gloglotto is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published
 * by the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * gloglotto is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with gloglotto. If not, see <http://www.gnu.org/licenses/>.
 */

#ifndef _GLOGLOTTO_ITERATOR_H
#define _GLOGLOTTO_ITERATOR_H

#include <iterator>

namespace gloglotto
{
	namespace iterator
	{
		template <class Type>
		struct accessible_traits
		{
			typedef typename Type::accessible_type                                type;
			typedef typename std::add_const<typename Type::accessible_type>::type const_type;

			static const int size = Type::accessible_size;
		};

		template <class Type, typename Constant>
		struct accessible_type;

		template <class Type>
		struct accessible_type<Type, std::true_type>
		{
			typedef typename accessible_traits<Type>::const_type type;
		};

		template <class Type>
		struct accessible_type<Type, std::false_type>
		{
			typedef typename accessible_traits<Type>::type type;
		};

		template <typename Class, typename Constant = std::false_type>
		class accessible : public std::iterator<std::random_access_iterator_tag,
		                                        typename accessible_type<Class, Constant>::type>
		{
			public:
				typedef typename accessible_type<Class, Constant>::type& reference;
				typedef typename accessible_type<Class, Constant>::type* pointer;

				static const int size = accessible_traits<Class>::size;

			public:
				accessible (Class* object, int current = 0);

				accessible (accessible<Class, Constant> const& from);

				reference operator *  (void) const;
				reference operator [] (int n) const;
				pointer   operator -> (void) const;

				accessible<Class, Constant>& operator ++ (void);
				accessible<Class, Constant>  operator ++ (int);

				accessible<Class, Constant>& operator -- (void);
				accessible<Class, Constant>  operator -- (int);

				accessible<Class, Constant>  operator +  (int n) const;
				accessible<Class, Constant>& operator += (int n);

				accessible<Class, Constant>  operator -  (int n) const;
				accessible<Class, Constant>& operator -= (int n);

				bool operator == (accessible<Class, Constant> const& other) const;
				bool operator != (accessible<Class, Constant> const& other) const;

				bool operator >  (accessible<Class, Constant> const& other) const;
				bool operator >= (accessible<Class, Constant> const& other) const;

				bool operator <  (accessible<Class, Constant> const& other) const;
				bool operator <= (accessible<Class, Constant> const& other) const;

			private:
				Class* _object;
				int    _current;
		};
	}
}

#include <gloglotto/iterator.tpp>

#endif
